function once that was 2,500 lines long